#! /usr/bin/env Rscript
ROOT_DIR = "~/Dropbox/LEPR03/nathan-workspace/"
IN_DIR = paste0(ROOT_DIR, "data/flu/san_diego/convert/")
MASTER.FILEPATH = paste0(ROOT_DIR, "data/flu/san_diego/merge/sd_county_by_cdc_week_2008-todate.csv")
master.df = read.csv(MASTER.FILEPATH, row.names = NULL, stringsAsFactors = FALSE)
CSV.filenames = list.files(IN_DIR, pattern="*.csv", full.names = TRUE)
CSV.filenames
lapply(function(filename) read.csv(filename, stringsAsFactors = FALSE, skip = 1), CSV.filenames)
dfs = lapply(CSV.filenames, function(filename) read.csv(filename, stringsAsFactors = FALSE, skip = 1))
dfs
dfs[[1]]
colnames(dfs[[1]])
colnames(dfs[[1]])[2]
str_extract(colnames(dfs[[1]])[2], "\\-*\\d+\\d*")
library(data.table)
library(DICE)
library(stringr)
str_extract(colnames(dfs[[1]])[2], "\\-*\\d+\\d*")
str_extract(colnames(dfs[[1]]), "\\-*\\d+\\d*")
CSV.filenames
CSV.filenames[2]
str_extract(str_extract(CSV.filename, "InfluenzaWatch_[0-9]*"), "\\-*\\d+\\d*")
str_extract(str_extract(CSV.filenames[2], "InfluenzaWatch_[0-9]*"), "\\-*\\d+\\d*")
dfs[2]
dfs = lapply(CSV.filenames, function(filename) read.csv(filename, stringsAsFactors = FALSE, skip = 1))
dfs
dfs = lapply(CSV.filenames, function(filename) read.csv(filename, stringsAsFactors = FALSE, skip = 1, row.names = 1))
dfs
dfs = lapply(CSV.filenames, function(filename) read.csv(filename, stringsAsFactors = FALSE, skip = 1, row.names = 1))
dfs[[2]]
dfs[[2]]$Week.43['Total']
dfs[[2]]["Total"]
dfs[[2]]["Total",]
dfs[[2]]["Total",]$Week.43
dfs[[2]]["Total",1]
rownames(dfs[[2]])
rownames(dfs[[2]])
which(rownames(dfs[[2]]), "Influenza")
which("Influenza", rownames(dfs[[2]]))
which(rownames(dfs[[2]]) == "Total")
which(rownames(dfs[[2]]) == "total")
grep("H1", rownames(dfs[[2]]))
rownames(dfs[[2]])[grep("H1", rownames(dfs[[2]]))]
grep("total", rownames(df), ignore.case = TRUE)
grep("total", rownames(dfs[[2]]), ignore.case = TRUE)
grep("A", rownames(df), ignore.case = TRUE)
grep("A", rownames(dfs[[2]]), ignore.case = TRUE)
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)
Victoria.row = grep("Vic", rownames(df), ignore.case = TRUE)
Yamagata.row = grep("Yam", rownames(df), ignore.case = TRUE)
AB.row = grep("A/B", rownames(df), ignore.case = TRUE)
Victoria.row
Victoria.row = grep("Vic", rownames(df[[2]]), ignore.case = TRUE)
Yamagata.row = grep("Yam", rownames(df[[2]]), ignore.case = TRUE)
AB.row = grep("A/B", rownames(df[[2]]), ignore.case = TRUE)
AB.row
grep("A/B", rownames(df[[2]]), ignore.case = TRUE)
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)
grep("Vic", rownames(dfs[[2]]), ignore.case = TRUE)
Victoria.row = grep("Vic", rownames(dfs[[2]]), ignore.case = TRUE)
Victoria.row = grep("Vic", rownames(dfs[[2]]), ignore.case = TRUE)
Yamagata.row = grep("Yam", rownames(dfs[[2]]), ignore.case = TRUE)
AB.row = grep("A/B", rownames(dfs[[2]]), ignore.case = TRUE)
Victoria.row
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)[-c(5)]
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)[-c(3)]
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)[-which(grep("B", rownames(dfs[[2]]), ignore.case = TRUE) == 5)]
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)[-which(grep("B", rownames(dfs[[2]]), ignore.case = TRUE) == 6)]
grep("B", rownames(dfs[[2]]), ignore.case = TRUE)[-which(grep("B", rownames(dfs[[2]]), ignore.case = TRUE) %in% c(4,7))]
paste0(year.num, year.num + 1)
year.num = 2015
paste0(year.num, year.num + 1)
year.num = '2015'
paste0(year.num, year.num + 1)
as.numeric(year.num) + 1
paste0(as.numeric(year.num) + 1, 'l')
year.num = str_extract(str_extract(CSV.filenames[2], "InfluenzaWatch_[0-9]*"), "\\-*\\d+\\d*")
year.num
master.df["2017-2018"]
master.df[,"2017-2018"]
master.df
MASTER.FILEPATH.1 = paste0(ROOT_DIR, "data/flu/san_diego/merge/sd_county_by_cdc_week_2008-todate.csv")
master.df.1 = read.csv(MASTER.FILEPATH.1, row.names = NULL, stringsAsFactors = FALSE)
master.df.1
master.df.1["weel"]
master.df.1["week"]
tmp = as.data.table(master.df.1)
tmp[week=4]
tmp["4"]
tmp[grep("4", week)]
tmp[grep("52", week)]
master.df.1[which(master.df.1$week == 43)]
master.df.1[which(master.df.1$week == 43),]
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
week.num''
week.num
mapply(function(df, filename) {
week.num = str_extract(colnames(df)[2], "\\-*\\d+\\d*")
year.num = str_extract(str_extract(filename, "InfluenzaWatch_[0-9]*"), "\\-*\\d+\\d*")
print (week.num)
print (year.num)
}, dfs, CSV.filenames)
mapply(function(df, filename) {
week.num = str_extract(colnames(df)[2], "\\-*\\d+\\d*")
year.num = str_extract(str_extract(filename, "InfluenzaWatch_[0-9]*"), "\\-*\\d+\\d*")
colnames(df)[2]
}, dfs, CSV.filenames)
dfs[[2]]
mapply(function(df, filename) {
week.num = str_extract(colnames(df)[1], "\\-*\\d+\\d*")
year.num = str_extract(str_extract(filename, "InfluenzaWatch_[0-9]*"), "\\-*\\d+\\d*")
print (week.num)
print (year.num)
}, dfs, CSV.filenames)
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
week.num
grep("Total", rownames(df), ignore.case = TRUE)
Total.row
which(rownames(df) == rownames(df)[-other.row.nums])
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1
master.df.1[which(master.df.1$week == week.num), which(colnames(master.df.1) == M1.select.column.name)]
master.df.1[which(master.df.1$week == week.num),]
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1[which(master.df.1$week == week.num), which(colnames(master.df.1) == M1.select.column.name)]
master.df.1[which(master.df.1$week == week.num),]
master.df.1[which(master.df.1$week == week.num),10]
which(colnames(master.df.1) == M1.select.column.name)
colnames(master.df.1)
M1.select.column.name
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1[which(master.df.1$week == week.num), which(colnames(master.df.1) == M1.select.column.name)]
which(colnames(master.df.1) == M1.select.column.name)
Total.row
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
df[Total.row, 1]
which(master.df.1$week == week.num)
master.df.1
master.df.1
df[Total.row, 1]
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1[which(master.df.1$week == week.num), which(colnames(master.df.1) == M1.select.column.name)]
master.df.1[which(master.df.1$week == week.num), which(colnames(master.df.1) == M1.select.column.name)] = df[Total.row, 1]
master.df.1[which(master.df.1$week == week.num), which(colnames(master.df.1) == M1.select.column.name)]
master.df.1[which(master.df.1$week == week.num), ]
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.1
last.row.master.2 = master.df.2[nrow(master.df.2),]
last.row.master.2
last.week.num = last.row.master.2$Week
last.week.num
master.df.2 = read.csv(MASTER.FILEPATH.2, row.names = NULL, stringsAsFactors = FALSE)
last.row.master.2 = master.df.2[nrow(master.df.2),]
last.row.master.2
AB.row = grep("A/B", rownames(df), ignore.case = TRUE)
AB.row
AB.row = grep("A/Bgh", rownames(df), ignore.case = TRUE)
AB.row
AB.row == 0
length(AB.row)
t = c(1,2,3)
t[t %in% c(1,3,integer(0))]
df[integer(0), 4]
CDCweek2date(41, 2017)
CDCweek2date(41, 2017) + 6
CDCweek2date(29, 2017) + 6
format("2017-12-12", %m %d %y)
format("2017-12-12", %m %d %Y)
format(as.date("2017-12-12"), %m %d %Y)
format(as.date("2017-12-12"), "%m %d %Y")
format("2017-12-12", "%m %d %Y")
format(as.Date("2017-12-12"), "%m %d %Y")
format(as.Date("2017-12-12"), "%m/%d/%Y")
format(as.Date("2017-12-27"), "%m/%d/%Y")
format(as.Date("2017-12-7"), "%m/%d/%Y")
source(paste0(ROOT_DIR, "code/scripts/general_scripts/rLib.R"))
source(paste0(ROOT_DIR, "code/scripts/generic_scripts/rLib.R"))
source(paste0(ROOT_DIR, "code/scripts/generic_scripts/utils.R"))
convertDateFormat(as.Date(("2017-12-27")))
source(paste0(ROOT_DIR, "code/scripts/generic_scripts/utils.R"))
convertDateFormat(as.Date(("2017-12-27")))
convertDateFormat(as.Date(("2017-12-07")))
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
NEW.ROW
df[A.H1.row, 1]
df[A.H3.row, 1]
if(length(Total.row) == 0) {
Total.row = NA
}
if(length(Total.row) == 0) {
Total.row = NA
}NEW.ROW = c(year.num, week.num, df[A.row, 1], df[A.H1.row, 1], df[A.H3.row, 1], df[B.Yamagata.row, 1],
df[B.Victoria.row, 1], df[B.row, 1], df[H1N1.row, 1], df[AB.row, 1], df[Total.row, 1], week.end.date)
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
NEW.ROW
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
Total.row
NEW.ROW
A.H1.row
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
NEW.ROW
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.2
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.2
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
master.df.2
master.df.1
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/update_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
year.num
last.row.year.num
yaer.num > last.row.year.num
year.num > last.row.year.num
year.num == last.row.year.num
week.num > last.row.week.num
week.num
colnames(df)[1]
colnames(df)
filename
i
dfs[[i]]
dfs
CSV.filenames
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
CSV.filenames
dfs
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
dfs[[1]]
dfs[[3]]
dfs[[4]]
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
source('~/Dropbox/LEPR03/nathan-workspace/code/scripts/san_diego/append_san_diego.R')
master.df.1
master.df.2
